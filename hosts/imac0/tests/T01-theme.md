# T01 - Theme Module Testing

**Feature**: Per-host theming via theme-hm.nix module  
**Host**: imac0  
**Theme**: warmGray (Workstation - Home)  
**Last Updated**: 2025-11-29

---

## Overview

This test verifies that the theme module correctly generates and applies themed configurations for:

1. **Starship** - Powerline prompt with warmGray palette
2. **Zellij** - Terminal multiplexer with themed UI
3. **Eza** - Directory listing colors

---

## Prerequisites

- [ ] Home Manager configuration applied: `home-manager switch --flake ".#markus@imac0"`
- [ ] Fish shell is the default shell
- [ ] Terminal supports 256 colors / true color

---

## Test Cases

### T01.1 - Starship Prompt (Visual)

**Steps:**

1. Open a new terminal window
2. Observe the prompt appearance

**Expected:**

- [ ] Powerline-style prompt with angled separators
- [ ] Gray color gradient (light → dark, left → right)
- [ ] OS icon (macOS ) visible on the left
- [ ] Directory path visible
- [ ] Username@hostname displayed
- [ ] Time shown on right side

**Verification Command:**

```bash
head -15 ~/.config/starship.toml
```

**Expected Output Contains:**

```
STARSHIP PROMPT - imac0 (Warm Gray)
Theme: warmGray (workstation)
Auto-generated by: modules/shared/theme-hm.nix
```

---

### T01.2 - Starship Error Badge

**Steps:**

1. Run a command that fails: `false`
2. Observe the prompt

**Expected:**

- [ ] Red error badge `✘ 1` appears before time
- [ ] Prompt character changes to red `✗`

**Verification Command:**

```bash
false; echo "Exit: $status"
```

---

### T01.3 - Starship Command Duration

**Steps:**

1. Run a slow command: `sleep 3`
2. Observe the prompt after completion

**Expected:**

- [ ] Duration indicator `⏱ 3s` appears
- [ ] Only shows for commands > 2 seconds

---

### T01.4 - Starship Sudo Indicator

**Steps:**

1. Run: `sudo echo "test"`
2. Enter password if prompted
3. Observe the next prompt

**Expected:**

- [ ] Amber lock icon appears near the right side
- [ ] Disappears after sudo timeout (typically 5 minutes)

---

### T01.5 - Zellij Theme

**Steps:**

1. Start zellij: `zellij`
2. Observe the UI colors

**Expected:**

- [ ] Header/footer background matches theme
- [ ] Tab frames use warmGray palette colors
- [ ] Session name visible

**Verification Command:**

```bash
head -10 ~/.config/zellij/config.kdl
```

**Expected Output Contains:**

```
ZELLIJ CONFIG - imac0 (Warm Gray)
Theme: warmGray (workstation)
Auto-generated by: modules/shared/theme-hm.nix
```

---

### T01.6 - Zellij Keybindings

**Steps:**

1. Inside zellij, press `Ctrl+e`
2. Observe mode change

**Expected:**

- [ ] Switches to Session mode
- [ ] Press `Ctrl+e` again returns to Normal mode

**Steps (Tab creation):**

1. Press `Ctrl+t` then `c`

**Expected:**

- [ ] New tab opens in home directory (`~`)

---

### T01.7 - Eza Colors

**Steps:**

1. Run: `ll` (alias for eza)
2. Observe directory colors

**Expected:**

- [ ] Directories shown in bold blue (consistent styling)
- [ ] Icons displayed (if terminal supports)

**Verification Command:**

```bash
echo "EZA_COLORS: $EZA_COLORS"
echo "LS_COLORS: $LS_COLORS"
```

**Expected Output:**

```
EZA_COLORS: di=1;34
LS_COLORS: di=1;34
```

---

### T01.8 - Theme Palette Verification

**Steps:**

1. Check which palette is applied

**Verification Command:**

```bash
grep -E "^# Theme:" ~/.config/starship.toml
grep -E "^// Theme:" ~/.config/zellij/config.kdl
```

**Expected Output:**

```
# Theme: warmGray (workstation)
// Theme: warmGray (workstation)
```

---

## Automated Test

Run the automated test script:

```bash
./hosts/imac0/tests/T01-theme.sh
```

---

## Troubleshooting

### Prompt not updating

```bash
exec fish  # Reload fish shell
```

### Zellij not using theme

```bash
zellij delete-all-sessions  # Clear old sessions
zellij  # Start fresh
```

### Colors look wrong

- Verify terminal supports true color: `echo $COLORTERM`
- Expected: `truecolor` or `24bit`

### Theme module not loading

```bash
# Check if module is imported
nix eval --json ".#homeConfigurations.\"markus@imac0\".config.theme.paletteName"
# Expected: "warmGray"
```

---

## Test Results

| Test  | Status | Date | Notes |
| ----- | ------ | ---- | ----- |
| T01.1 | ⬜     |      |       |
| T01.2 | ⬜     |      |       |
| T01.3 | ⬜     |      |       |
| T01.4 | ⬜     |      |       |
| T01.5 | ⬜     |      |       |
| T01.6 | ⬜     |      |       |
| T01.7 | ⬜     |      |       |
| T01.8 | ⬜     |      |       |

**Legend:** ✅ Pass | ❌ Fail | ⬜ Not Run

---

## Related Files

- `modules/shared/theme-hm.nix` - Theme Home Manager module
- `modules/shared/theme-palettes.nix` - Color palette definitions
- `hosts/imac0/home.nix` - Host configuration (imports theme module)
