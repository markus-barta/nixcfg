services:
  openclaw-percaival:
    build: ./openclaw-percaival
    container_name: openclaw-percaival
    restart: unless-stopped
    network_mode: host
    volumes:
      - /var/lib/openclaw-percaival/data:/home/node/.openclaw:rw
      - /var/lib/openclaw-percaival/gogcli:/home/node/.config/gogcli:rw
      - /var/lib/openclaw-percaival/m365:/home/node/.config/cli-microsoft365:rw
      # Git-managed config (read-only source, copied to data volume at boot)
      - ./openclaw-percaival/openclaw.json:/home/node/.openclaw-config/openclaw.json:ro
      # Secrets (read-only, mounted from agenix)
      - /run/agenix/miniserver-bp-openclaw-telegram-token:/run/secrets/telegram-token:ro
      - /run/agenix/miniserver-bp-openclaw-gateway-token:/run/secrets/gateway-token:ro
      - /run/agenix/miniserver-bp-openclaw-openrouter-key:/run/secrets/openrouter-key:ro
      - /run/agenix/miniserver-bp-openclaw-brave-key:/run/secrets/brave-key:ro
      - /run/agenix/miniserver-bp-m365-client-id:/run/secrets/m365-client-id:ro
      - /run/agenix/miniserver-bp-m365-tenant-id:/run/secrets/m365-tenant-id:ro
      - /run/agenix/miniserver-bp-m365-client-secret:/run/secrets/m365-client-secret:ro
      - /run/agenix/miniserver-bp-github-pat:/run/secrets/github-pat:ro
      - /run/agenix/miniserver-bp-mattermost-bot-token:/run/secrets/mattermost-bot-token:ro
    environment:
      GOG_KEYRING_BACKEND: "file"
      GOG_ACCOUNT: "percy.ai@bytepoets.com"
      # docker exec sources this file to get secrets into env
      BASH_ENV: "/home/node/.env"
      ENV: "/home/node/.env"
    env_file:
      - /run/agenix/miniserver-bp-gogcli-keyring-password
    user: "node"
    entrypoint: ["/home/node/entrypoint.sh"]
    labels:
      - com.centurylinklabs.watchtower.enable=false
