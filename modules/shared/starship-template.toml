# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                     STARSHIP PROMPT - __HOSTNAME__ (__PALETTE_NAME__)
# ╚══════════════════════════════════════════════════════════════════════════════╝
#
# Theme: __PALETTE_NAME__ (__CATEGORY__)
# Palette Key: __PALETTE_KEY__
# Auto-generated by: modules/shared/theme-hm.nix
#
# Features:
#   - Powerline gradient (__PALETTE_NAME__ spectrum)
#   - Root alert (red warning segment)
#   - Exit status badge (on error)
#   - Sudo cached indicator
#   - Command duration (> 2s)
#   - Background jobs indicator
#   - Success/error character prompt
#   - System metrics (CPU, RAM, Load, Swap) via StaSysMo
#

"$schema" = 'https://starship.rs/config-schema.json'

# ════════════════════════════════════════════════════════════════════════════════
# PROMPT FORMAT
# ════════════════════════════════════════════════════════════════════════════════
#
# Left side: Rounded RIGHT arrows () for transitions
# Right side: Rounded LEFT arrow () to START, then RIGHT arrows ()
#

format = """
${custom.root_alert}\
[░▒▓](__LIGHTEST__)\
$os\
[](bg:__PRIMARY__ fg:__LIGHTEST__)\
$directory\
[](fg:__PRIMARY__ bg:__SECONDARY__)\
$username\
$hostname\
[](fg:__SECONDARY__ bg:__MIDDARK__)\
$jobs\
$git_branch\
$git_status\
${custom.gitcount}\
[](fg:__MIDDARK__ bg:__DARK__)\
$nodejs\
$python\
$rust\
$golang\
$php\
$docker_context\
[](fg:__DARK__)\
$fill\
${custom.stasysmo}\
$status\
[](fg:__DARKER__)\
$time\
$cmd_duration\
[](fg:__DARKER__ bg:__DARKEST__)\
$sudo\
$nix_shell\
[](fg:__DARKEST__)\
\n$character"""

# ════════════════════════════════════════════════════════════════════════════════
# ROOT ALERT - Danger segment (only when root)
# ════════════════════════════════════════════════════════════════════════════════

[custom.root_alert]
command = "echo '⚠'"
when = "test $USER = root"
style = "bold fg:__ROOT_FG__ bg:__ROOT_BG__"
format = "[ $output ]($style)"

# ════════════════════════════════════════════════════════════════════════════════
# OS ICON
# ════════════════════════════════════════════════════════════════════════════════

[os]
disabled = false
style = "bg:__LIGHTEST__ fg:__TEXT_ON_LIGHTEST__"
format = "[ $symbol ]($style)"

[os.symbols]
Macos = ""
NixOS = ""
Linux = ""

# ════════════════════════════════════════════════════════════════════════════════
# DIRECTORY
# ════════════════════════════════════════════════════════════════════════════════

[directory]
style = "fg:__TEXT_ON_MEDIUM__ bg:__PRIMARY__"
format = "[ $path ]($style)"
truncation_length = 0
truncate_to_repo = false
truncation_symbol = "…/"

[directory.substitutions]
"Documents" = "󰈙 "
"Downloads" = " "
"Music" = " "
"Pictures" = " "

# ════════════════════════════════════════════════════════════════════════════════
# USERNAME & HOSTNAME
# ════════════════════════════════════════════════════════════════════════════════

[username]
show_always = true
style_user = "fg:__TEXT_ON_SECONDARY__ bg:__SECONDARY__"
style_root = "fg:__ROOT_BG__ bg:__SECONDARY__"
format = '[ $user]($style)'

[hostname]
ssh_only = false
style = "fg:__TEXT_ON_SECONDARY__ bg:__SECONDARY__"
format = '[@$hostname ]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# JOBS (Background processes)
# ════════════════════════════════════════════════════════════════════════════════

[jobs]
symbol = "✦"
style = "fg:__TEXT_ACCENT__ bg:__MIDDARK__"
number_threshold = 1
format = '[[ $symbol$number ](fg:__TEXT_ACCENT__ bg:__MIDDARK__)]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# GIT
# ════════════════════════════════════════════════════════════════════════════════

[git_branch]
symbol = ""
style = "bg:__MIDDARK__"
format = '[[ $symbol $branch ](fg:__TEXT_ACCENT__ bg:__MIDDARK__)]($style)'

[git_status]
style = "bg:__MIDDARK__"
format = '[[($all_status$ahead_behind )](fg:__TEXT_ACCENT__ bg:__MIDDARK__)]($style)'

[custom.gitcount]
command = "git rev-list --count HEAD 2>/dev/null"
when = "git rev-parse --is-inside-work-tree 2>/dev/null"
style = "bg:__MIDDARK__"
format = "[[#$output ](fg:__TEXT_MUTED__ bg:__MIDDARK__)]($style)"

# ════════════════════════════════════════════════════════════════════════════════
# LANGUAGES
# ════════════════════════════════════════════════════════════════════════════════

[nodejs]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol ($version) ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'

[python]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol ($version) ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'

[rust]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol ($version) ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'

[golang]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol ($version) ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'

[php]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol ($version) ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'

[docker_context]
symbol = ""
style = "bg:__DARK__"
format = '[[ $symbol $context ](fg:__TEXT_ACCENT__ bg:__DARK__)]($style)'
only_with_files = true

# ════════════════════════════════════════════════════════════════════════════════
# FILL (flexible space between left and right)
# ════════════════════════════════════════════════════════════════════════════════

[fill]
symbol = " "

# ════════════════════════════════════════════════════════════════════════════════
# STASYSMO (Starship System Monitoring - CPU, RAM, Load, Swap)
# ════════════════════════════════════════════════════════════════════════════════
# Requires stasysmo-daemon to be running (systemd on NixOS, launchd on macOS)
# Gracefully shows nothing if daemon not running or data stale
# Powerline segment with same background as nix_shell (impure) for visual consistency

[custom.stasysmo]
command = "stasysmo-reader"
when = "test -f /dev/shm/stasysmo/timestamp || test -f /tmp/stasysmo/timestamp"
# Rounded left cap () starts segment, content with __DARKEST__ bg, rounded right cap () ends
format = "[](fg:__DARKEST__)[[ $output ](fg:__TEXT_MUTED__ bg:__DARKEST__)]($style)[](fg:__DARKEST__)"
style = "bg:__DARKEST__"

# ════════════════════════════════════════════════════════════════════════════════
# STATUS (Exit code on error)
# ════════════════════════════════════════════════════════════════════════════════

[status]
disabled = false
style = "bold fg:__ERROR_BG__"
symbol = "✘"
format = '[$symbol $status ]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# COMMAND DURATION (> 2 seconds)
# ════════════════════════════════════════════════════════════════════════════════

[cmd_duration]
min_time = 2000
style = "bg:__DARKER__"
format = '[[(⏱ $duration) ](fg:__TEXT_MUTED__ bg:__DARKER__)]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# TIME
# ════════════════════════════════════════════════════════════════════════════════

[time]
disabled = false
time_format = "%T"
style = "bg:__DARKER__"
format = '[[  $time ](fg:__TEXT_MUTED_LIGHT__ bg:__DARKER__)]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# SUDO (cached credentials)
# ════════════════════════════════════════════════════════════════════════════════

[sudo]
disabled = false
style = "fg:__SUDO_FG__ bg:__DARKEST__"
symbol = ""
format = '[[$symbol](fg:__SUDO_FG__ bg:__DARKEST__)]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# NIX SHELL
# ════════════════════════════════════════════════════════════════════════════════

[nix_shell]
symbol = ""
style = "bg:__DARKEST__"
format = '[[ $symbol $state ](fg:__TEXT_MUTED__ bg:__DARKEST__)]($style)'

# ════════════════════════════════════════════════════════════════════════════════
# CHARACTER (Prompt on new line)
# ════════════════════════════════════════════════════════════════════════════════

[character]
success_symbol = "[❯](bold fg:__TEXT_ACCENT__)"
error_symbol = "[✗](bold fg:__ERROR_BG__)"
